<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZHTP Quantum Browser - Decentralized Internet</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a3a 30%, #2d1b69 60%, #4a0080 100%);
            color: #ffffff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Quantum Particle Effects */
        .quantum-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .particle {
            position: absolute;
            width: 3px;
            height: 3px;
            background: #00ffff;
            border-radius: 50%;
            opacity: 0.7;
            animation: quantumFloat 6s infinite ease-in-out;
        }

        @keyframes quantumFloat {
            0%, 100% { transform: translateY(0) rotate(0deg) scale(1); opacity: 0.7; }
            25% { transform: translateY(-20px) rotate(90deg) scale(1.2); opacity: 1; }
            50% { transform: translateY(-40px) rotate(180deg) scale(0.8); opacity: 0.5; }
            75% { transform: translateY(-20px) rotate(270deg) scale(1.1); opacity: 0.9; }
        }

        /* Main Browser Container */
        .browser-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 2;
        }
        
        /* Browser Header */
        .browser-header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px 15px 0 0;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0;
        }

        .browser-title {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(45deg, #00ffff, #ff00ff, #ffff00);
            background-size: 200% 200%;
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gradientShift 3s ease-in-out infinite;
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        /* User Info Section */
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .network-selector {
            background: rgba(0, 255, 255, 0.2);
            border: 1px solid rgba(0, 255, 255, 0.5);
            border-radius: 10px;
            padding: 8px 15px;
            color: #00ffff;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .network-selector:hover {
            background: rgba(0, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .user-menu {
            position: relative;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(45deg, #00ffff, #ff00ff);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .user-avatar:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
            user-select: none;
        }

        /* Navigation Bar */
        .nav-bar {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-top: none;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .nav-button {
            background: linear-gradient(45deg, rgba(0, 255, 255, 0.2), rgba(255, 0, 255, 0.2));
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            padding: 10px 20px;
            color: #ffffff;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .nav-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }

        .nav-button:hover::before {
            left: 100%;
        }

        .nav-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 255, 255, 0.4);
        }

        .url-bar {
            flex: 1;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 12px 15px;
            color: #ffffff;
            font-size: 16px;
            outline: none;
            transition: all 0.3s ease;
        }

        .url-bar:focus {
            border-color: #00ffff;
            background: rgba(0, 255, 255, 0.1);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
        }

        /* Browser Tabs */
        .browser-tabs {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-top: none;
            display: flex;
        }
        
        .tab {
            padding: 15px 25px;
            cursor: pointer;
            border-right: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            font-weight: 600;
            position: relative;
            overflow: hidden;
        }

        .tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }

        .tab:hover::before,
        .tab.active::before {
            left: 100%;
        }

        .tab.active {
            background: rgba(0, 255, 255, 0.2);
            color: #00ffff;
            border-bottom: 2px solid #00ffff;
        }

        .tab:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        /* Main Content Area */
        .content-area {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-top: none;
            border-radius: 0 0 15px 15px;
            min-height: 600px;
            padding: 25px;
        }

        /* Network Status */
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 10px;
            padding: 15px 20px;
            margin-bottom: 25px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #00ff00;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.2); }
        }

        /* Network Stats Grid */
        .network-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 255, 255, 0.2);
        }

        .stat-card .value {
            font-size: 2rem;
            font-weight: 700;
            color: #00ffff;
            margin-bottom: 5px;
        }

        .stat-card .label {
            opacity: 0.8;
            font-size: 14px;
        }

        /* DApp Cards */
        .dapp-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .dapp-card {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .dapp-card:hover {
            background: rgba(255, 255, 255, 0.12);
            border-color: rgba(0, 255, 255, 0.5);
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 255, 255, 0.3);
        }

        .dapp-card h3 {
            color: #00ffff;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .dapp-card .domain {
            font-family: monospace;
            color: #ffff00;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .dapp-status {
            display: inline-block;
            padding: 4px 12px;
            background: rgba(0, 255, 0, 0.2);
            color: #00ff00;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 10px;
        }

        /* Explorer Cards */
        .explorer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .explorer-card {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 25px;
            transition: all 0.3s ease;
        }

        .explorer-card:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 255, 255, 0.2);
        }

        .explorer-card h3 {
            color: #00ffff;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 15px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            color: #ffffff;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #00ffff;
            background: rgba(0, 255, 255, 0.1);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
        }

        .form-group input::placeholder,
        .form-group textarea::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        /* Action Buttons */
        .action-btn {
            background: linear-gradient(45deg, #00ffff, #0080ff);
            color: #ffffff;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            width: 100%;
            margin: 5px 0;
        }

        .action-btn:hover {
            background: linear-gradient(45deg, #00cccc, #0066cc);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 255, 255, 0.4);
        }

        .action-btn:active {
            transform: translateY(0);
        }

        .action-btn.danger {
            background: linear-gradient(45deg, #ff0080, #ff4000);
        }

        .action-btn.danger:hover {
            background: linear-gradient(45deg, #cc0066, #cc3300);
            box-shadow: 0 10px 25px rgba(255, 0, 128, 0.4);
        }

        .action-btn.success {
            background: linear-gradient(45deg, #00ff80, #40ff00);
        }

        .action-btn.success:hover {
            background: linear-gradient(45deg, #00cc66, #33cc00);
            box-shadow: 0 10px 25px rgba(0, 255, 128, 0.4);
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 255, 255, 0.9);
            color: #000000;
            padding: 15px 20px;
            border-radius: 10px;
            font-weight: 600;
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
        }

        .toast.success {
            background: rgba(0, 255, 0, 0.9);
        }

        .toast.error {
            background: rgba(255, 0, 0, 0.9);
            color: #ffffff;
        }

        .toast.warning {
            background: rgba(255, 255, 0, 0.9);
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #00ffff;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .browser-container {
                padding: 10px;
            }
            
            .browser-header {
                flex-direction: column;
                gap: 15px;
                position: relative;
                z-index: 9999;
            }
            
            .nav-bar {
                flex-wrap: wrap;
                gap: 10px;
            }
            
            .browser-tabs {
                flex-wrap: wrap;
            }
            
            .network-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .dapp-grid,
            .explorer-grid {
                grid-template-columns: 1fr;
            }
        }

        /* User Dropdown Menu */
        .user-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 10px 0;
            min-width: 200px;
            z-index: 9999;
            display: none;
            user-select: none;
        }

        .user-dropdown.active {
            display: block;
        }

        .dropdown-item {
            padding: 12px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .dropdown-item:hover {
            background: rgba(0, 255, 255, 0.2);
        }

        .dropdown-item:last-child {
            border-bottom: none;
        }

        /* Hidden content for tabs */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <!-- Quantum Particle Effects -->
    <div class="quantum-particles" id="quantumParticles"></div>
    
    <div class="browser-container">
        <!-- Browser Header -->
        <div class="browser-header">
            <h1 class="browser-title">ZHTP Quantum Browser</h1>
            
            <div class="user-info">
                <select class="network-selector" id="networkSelector" onchange="switchNetwork(this.value)">
                    <option value="mainnet" selected>üü¢ Mainnet</option>
                    <option value="testnet">üü° Testnet</option>
                    <option value="local">üîµ Local</option>
                </select>
                
                <div class="user-menu">
                    <div class="user-avatar" onclick="toggleUserMenu()" id="userAvatar">U</div>
                    <div class="user-dropdown" id="userDropdown">
                        <div class="dropdown-item" onclick="showWalletDetails()">üí≥ Wallet Details</div>
                        <div class="dropdown-item" onclick="showEarnings()">üí∞ Earnings</div>
                        <div class="dropdown-item" onclick="showSettings()">‚öôÔ∏è Settings</div>
                        <div class="dropdown-item" onclick="signOut()">üö™ Sign Out</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation Bar -->
        <div class="nav-bar">
            <button class="nav-button" onclick="goBack()">‚Üê Back</button>
            <button class="nav-button" onclick="goForward()">Forward ‚Üí</button>
            <button class="nav-button" onclick="goHome()">üè† Home</button>
            <input type="text" class="url-bar" id="urlBar" placeholder="Enter ZHTP domain (e.g., news.zhtp) or traditional URL..." onkeypress="if(event.key==='Enter') navigate()">
            <button class="nav-button" onclick="navigate()">‚Üí Go</button>
            <button class="nav-button" onclick="location.reload()">üîÑ Refresh</button>
        </div>

        <!-- Browser Tabs -->
        <div class="browser-tabs">
            <div class="tab active" onclick="switchTab('network')" id="networkTab">üåê Network Monitor</div>
            <div class="tab" onclick="switchTab('explorer')" id="explorerTab">üöÄ DApp Explorer</div>
            <div class="tab" onclick="switchTab('wallet')" id="walletTab">üí≥ Wallet</div>
            <div class="tab" onclick="switchTab('dns')" id="dnsTab">üåç DNS Registry</div>
            <div class="tab" onclick="switchTab('dao')" id="daoTab">üèõÔ∏è DAO</div>
            <div class="tab" onclick="switchTab('tools')" id="toolsTab">üõ†Ô∏è Dev Tools</div>
        </div>

        <!-- Main Content Area -->
        <div class="content-area">
            <!-- Network Status -->
            <div class="status-bar">
                <div class="status-item">
                    <div class="status-indicator" id="networkStatus"></div>
                    <span>Network: <span id="networkStatusText">Connecting...</span></span>
                </div>
                <div class="status-item">
                    <div class="status-indicator" id="consensusStatus"></div>
                    <span>Consensus: <span id="consensusStatusText">Syncing...</span></span>
                </div>
                <div class="status-item">
                    <div class="status-indicator" id="zkStatus"></div>
                    <span>ZK Proofs: <span id="zkStatusText">Verifying...</span></span>
                </div>
                <div class="status-item">
                    <span>Connected Peers: <span id="peerCount">0</span></span>
                </div>
            </div>

            <!-- Network Monitor Tab Content -->
            <div id="networkContent" class="tab-content active">
                <h2>üåê Network Monitor</h2>
                
                <!-- Network Stats -->
                <div class="network-stats">
                    <div class="stat-card">
                        <div class="value" id="connectedNodes">-</div>
                        <div class="label">Connected Nodes</div>
                    </div>
                    <div class="stat-card">
                        <div class="value" id="consensusRounds">-</div>
                        <div class="label">Consensus Rounds</div>
                    </div>
                    <div class="stat-card">
                        <div class="value" id="zkProofs">-</div>
                        <div class="label">ZK Transactions</div>
                    </div>
                    <div class="stat-card">
                        <div class="value" id="dappCount">-</div>
                        <div class="label">Active DApps</div>
                    </div>
                </div>

                <!-- Available DApps -->
                <h3>ÔøΩ Live Network Activity</h3>
                <div class="logs" id="activityLogs" style="background: rgba(0, 0, 0, 0.4); padding: 20px; border-radius: 15px; border: 1px solid rgba(255, 255, 255, 0.1); max-height: 300px; overflow-y: auto; font-family: monospace; font-size: 13px; line-height: 1.4; margin-bottom: 25px;">
                    <div class="log-entry" style="margin-bottom: 8px; padding: 5px 0; border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                        <span class="log-timestamp" style="color: #888888; margin-right: 10px;">[00:00:00]</span>
                        <span class="log-info" style="color: #00ffff;">Initializing ZHTP Network Monitor...</span>
                    </div>
                </div>

                <!-- Available DApps -->
                <h3>ÔøΩüöÄ Available DApps</h3>
                <div class="dapp-grid" id="dappGrid">
                    <div class="loading"></div>
                </div>
            </div>

            // DApp Explorer Tab Content -->
            <div id="explorerContent" class="tab-content">
                <h2>üöÄ DApp Explorer & Development Hub</h2>
                
                <div class="search-section" style="margin-bottom: 25px;">
                    <input type="text" class="url-bar" id="searchInput" placeholder="Search domains, DApps, contracts, or transactions..." onkeyup="searchNetwork()">
                    <div style="display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap;">
                        <button class="action-btn" onclick="searchNetwork('dns')" style="flex: 1;">üåç DNS Lookup</button>
                        <button class="action-btn" onclick="searchNetwork('dapp')" style="flex: 1;">üöÄ Find DApp</button>
                        <button class="action-btn" onclick="searchNetwork('contract')" style="flex: 1;">üìú Contract</button>
                        <button class="action-btn" onclick="searchNetwork('transaction')" style="flex: 1;">üí∞ Transaction</button>
                    </div>
                </div>
                
                <div class="explorer-grid">
                    <div class="explorer-card">
                        <h3>üåê Quick Access</h3>
                        <p>Popular ZHTP domains and services</p>
                        <button class="action-btn" onclick="loadDomain('news.zhtp')" style="margin: 5px 0;">üì∞ news.zhtp</button>
                        <button class="action-btn" onclick="loadDomain('market.zhtp')" style="margin: 5px 0;">üõí market.zhtp</button>
                        <button class="action-btn" onclick="loadDomain('whisper.zhtp')" style="margin: 5px 0;">üí¨ whisper.zhtp</button>
                        <button class="action-btn" onclick="loadDomain('faucet.zhtp')" style="margin: 5px 0;">üíß faucet.zhtp</button>
                    </div>
                    
                    <div class="explorer-card">
                        <h3>‚öôÔ∏è Node Configuration</h3>
                        <p>Configure multiple node types for messaging and earnings</p>
                        <button class="action-btn" onclick="window.open('./multi-node-setup.html', '_blank')" style="margin: 5px 0; background: linear-gradient(45deg, #00ff00, #00aa00);">üöÄ Multi-Node Setup</button>
                        <button class="action-btn" onclick="window.open('./debug-network.html', '_blank')" style="margin: 5px 0;">üõ†Ô∏è Network Debug</button>
                        <button class="action-btn" onclick="window.open('./whisper.html', '_blank')" style="margin: 5px 0;">üí¨ Whisper App</button>
                        <button class="action-btn" onclick="window.open('./welcome-merged.html', '_blank')" style="margin: 5px 0;">üéØ Onboarding</button>
                    </div>
                    
                    <div class="explorer-card">
                        <h3>üìä Latest Activity</h3>
                        <div id="latestActivity">
                            <div style="margin: 10px 0; padding: 10px; background: rgba(0,255,255,0.1); border-radius: 5px;">
                                <p>üÜï DApp deployed: <strong>ZHTP News Hub</strong></p>
                                <p>üîê Certificate issued: <strong>news.zhtp</strong></p>
                                <p>üí∞ Rewards distributed: <strong>3000 ZHTP</strong></p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="explorer-card">
                        <h3>üèóÔ∏è Deploy New DApp</h3>
                        <p>Deploy your decentralized application on the ZHTP network.</p>
                        <div class="form-group">
                            <input type="text" id="dappName" placeholder="DApp name">
                        </div>
                        <div class="form-group">
                            <textarea id="dappDescription" placeholder="DApp description..." rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <input type="file" id="dappCode" accept=".wasm,.js,.html,.zip">
                        </div>
                        <button class="action-btn" onclick="deployDApp()">Deploy DApp</button>
                        <div id="deployStatus"></div>
                    </div>
                    
                    <div class="explorer-card">
                        <h3>üåç Register Domain</h3>
                        <p>Register a .zhtp domain for your application or service.</p>
                        <div class="form-group">
                            <input type="text" id="domainInput" placeholder="Enter domain name (e.g., mysite.zhtp)">
                        </div>
                        <button class="action-btn success" onclick="registerDomain()">Register ZHTP Domain</button>
                        <div id="domainStatus">
                            <p><strong>Your Domains:</strong></p>
                            <div id="userDomains">No domains registered</div>
                        </div>
                    </div>
                </div>
                
                <div id="searchResults" style="margin-top: 25px;"></div>
            </div>

            <!-- Wallet Tab Content -->
            <div id="walletContent" class="tab-content">
                <h2>üí≥ Quantum Wallet</h2>
                
                <div class="explorer-grid">
                    <div class="explorer-card">
                        <h3>üí∞ Wallet Overview</h3>
                        <div id="walletInfo">
                            <p><strong>Address:</strong> <span id="walletAddress">Not connected</span></p>
                            <p><strong>Balance:</strong> <span id="walletBalance">0 ZHTP</span></p>
                            <p><strong>Network:</strong> <span id="walletNetwork">Testnet</span></p>
                        </div>
                        <button class="action-btn" onclick="createQuantumWallet()">Create Quantum Wallet</button>
                        <button class="action-btn success" onclick="requestTestTokens()">Request Test Tokens</button>
                        <button class="action-btn danger" onclick="resetWallet()">Reset Wallet</button>
                    </div>
                    
                    <div class="explorer-card">
                        <h3>üí∏ Send Transaction</h3>
                        <div class="form-group">
                            <input type="text" id="sendTo" placeholder="Recipient address">
                        </div>
                        <div class="form-group">
                            <input type="number" id="sendAmount" placeholder="Amount (ZHTP)" step="0.001">
                        </div>
                        <div class="form-group">
                            <textarea id="sendMessage" placeholder="Optional message..." rows="3"></textarea>
                        </div>
                        <button class="action-btn" onclick="sendTransaction()">Send ZHTP</button>
                        <div id="transactionStatus"></div>
                    </div>
                    
                    <div class="explorer-card">
                        <h3>üìä Transaction History</h3>
                        <div id="transactionHistory">
                            <p>No transactions yet</p>
                        </div>
                        <button class="action-btn" onclick="refreshTransactions()">Refresh History</button>
                    </div>
                </div>
            </div>

            <!-- DNS Registry Tab Content -->
            <div id="dnsContent" class="tab-content">
                <h2>üåç Blockchain DNS Registry</h2>
                
                <div class="explorer-grid">
                    <div class="explorer-card">
                        <h3>üîç DNS Lookup</h3>
                        <div class="form-group">
                            <input type="text" id="dnsLookup" placeholder="Enter domain to resolve (e.g., news.zhtp)">
                        </div>
                        <button class="action-btn" onclick="resolveDomain()">Resolve Domain</button>
                        <div id="dnsResults"></div>
                    </div>
                    
                    <div class="explorer-card">
                        <h3>üìã DNS Records</h3>
                        <div id="dnsRegistry">
                            <div class="loading"></div>
                        </div>
                        <button class="action-btn" onclick="refreshDNS()">Refresh DNS</button>
                    </div>
                </div>
            </div>

            <!-- DAO Tab Content -->
            <div id="daoContent" class="tab-content">
                <h2>üèõÔ∏è DAO Governance</h2>
                
                <div class="explorer-grid">
                    <div class="explorer-card">
                        <h3>üìù Submit Proposal</h3>
                        <div class="form-group">
                            <input type="text" id="proposalTitle" placeholder="Proposal title">
                        </div>
                        <div class="form-group">
                            <textarea id="proposalDescription" placeholder="Proposal description..." rows="4"></textarea>
                        </div>
                        <div class="form-group">
                            <select id="proposalType">
                                <option value="feature">Feature Request</option>
                                <option value="upgrade">Network Upgrade</option>
                                <option value="funding">Funding Request</option>
                                <option value="governance">Governance Change</option>
                            </select>
                        </div>
                        <button class="action-btn" onclick="submitProposal()">Submit DAO Proposal</button>
                        <div id="proposalStatus"></div>
                    </div>
                    
                    <div class="explorer-card">
                        <h3>üó≥Ô∏è Active Proposals</h3>
                        <div id="activeProposals">
                            <div class="loading"></div>
                        </div>
                        <button class="action-btn" onclick="refreshProposals()">Refresh Proposals</button>
                    </div>
                    
                    <div class="explorer-card">
                        <h3>üìä Your Voting Power</h3>
                        <div id="votingPower">
                            <p><strong>ZHTP Staked:</strong> <span id="stakedAmount">0 ZHTP</span></p>
                            <p><strong>Voting Weight:</strong> <span id="votingWeight">0%</span></p>
                        </div>
                        <button class="action-btn success" onclick="stakeTokens()">Stake ZHTP</button>
                    </div>
                </div>
            </div>

            <!-- Developer Tools Tab Content -->
            <div id="toolsContent" class="tab-content">
                <h2>üõ†Ô∏è Developer Tools</h2>
                
                <div class="explorer-grid">
                    <div class="explorer-card">
                        <h3>üîß Smart Contract Deployment</h3>
                        <div class="form-group">
                            <input type="text" id="contractName" placeholder="Contract name">
                        </div>
                        <div class="form-group">
                            <textarea id="contractCode" placeholder="Contract code (WASM or JavaScript)..." rows="6"></textarea>
                        </div>
                        <button class="action-btn" onclick="deployContract()">Deploy Contract</button>
                        <div id="contractStatus"></div>
                    </div>
                    
                    <div class="explorer-card">
                        <h3>üß™ Network Testing</h3>
                        <button class="action-btn" onclick="testNetwork()">Test Network Connection</button>
                        <button class="action-btn" onclick="testConsensus()">Test Consensus</button>
                        <button class="action-btn" onclick="testZKProofs()">Test ZK Proofs</button>
                        <div id="testResults"></div>
                    </div>
                    
                    <div class="explorer-card">
                        <h3>üìä Network Analytics</h3>
                        <div id="analyticsData">
                            <div class="loading"></div>
                        </div>
                        <button class="action-btn" onclick="generateReport()">Generate Report</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let currentUser = null;
        let currentWallet = null;
        let networkData = {};
        let dappsData = [];

        // Initialize quantum particles
        function initQuantumParticles() {
            const container = document.getElementById('quantumParticles');
            const particleCount = 50;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 6 + 's';
                particle.style.animationDuration = (4 + Math.random() * 4) + 's';
                container.appendChild(particle);
            }
        }

        // Logging system for live network activity
        function addLog(message, type = 'info') {
            const logs = document.getElementById('activityLogs');
            if (!logs) return;
            
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.style.marginBottom = '8px';
            logEntry.style.padding = '5px 0';
            logEntry.style.borderBottom = '1px solid rgba(255, 255, 255, 0.1)';
            
            const colorMap = {
                'info': '#00ffff',
                'success': '#00ff00',
                'error': '#ff4444',
                'warning': '#ffaa00'
            };
            
            logEntry.innerHTML = `
                <span class="log-timestamp" style="color: #888888; margin-right: 10px;">[${timestamp}]</span>
                <span class="log-${type}" style="color: ${colorMap[type] || '#ffffff'};">${message}</span>
            `;
            
            logs.appendChild(logEntry);
            logs.scrollTop = logs.scrollHeight;
            
            // Keep only last 50 entries
            const entries = logs.querySelectorAll('.log-entry');
            if (entries.length > 50) {
                entries[0].remove();
            }
        }

        // Start network monitoring with live feed
        function startNetworkMonitoring() {
            addLog('üöÄ Network monitoring started', 'success');
            addLog('üì° Connecting to ZHTP network...', 'info');
            
            // Monitor network status every 10 seconds
            setInterval(async () => {
                try {
                    const response = await fetch('/api/status');
                    const data = await response.json();
                    
                    if (data.status === 'operational') {
                        addLog(`üìä Network: ${data.connected_nodes} nodes, ${data.consensus_rounds} consensus rounds`, 'info');
                        
                        // Update the stats
                        document.getElementById('connectedNodes').textContent = data.connected_nodes;
                        document.getElementById('consensusRounds').textContent = data.consensus_rounds;
                        document.getElementById('zkProofs').textContent = data.zk_transactions || 0;
                        document.getElementById('dappCount').textContent = data.dapp_count;
                    }
                } catch (error) {
                    addLog('‚ö†Ô∏è Network status check failed', 'error');
                }
            }, 10000);
            
            // Monitor real network activities via API
            setInterval(async () => {
                try {
                    const response = await fetch('/api/network/activity');
                    const data = await response.json();
                    
                    if (data.success && data.activities) {
                        data.activities.forEach(activity => {
                            addLog(activity.message, activity.type || 'info');
                        });
                    }
                } catch (error) {
                    // If activity API fails, just skip - don't spam logs
                    console.log('Activity API not available:', error);
                }
            }, 5000);
        }

        // Authentication check
        function checkAuthentication() {
            // Check for wallet parameter in URL (from welcome page)
            const urlParams = new URLSearchParams(window.location.search);
            const walletParam = urlParams.get('wallet');
            
            if (walletParam) {
                // User came from onboarding, load their session
                const sessionData = sessionStorage.getItem('zhtp_session');
                if (sessionData) {
                    const session = JSON.parse(sessionData);
                    currentUser = session.wallet;
                    showUserInfo();
                    showToast(`Welcome! Signed in with ${currentUser.signInMethod || 'wallet'}`, 'success');
                    
                    // Clean up URL to prevent reload loops - remove wallet parameter
                    if (window.history && window.history.replaceState) {
                        const newUrl = window.location.protocol + "//" + window.location.host + window.location.pathname;
                        window.history.replaceState({}, document.title, newUrl);
                    }
                    return;
                }
            }

            // Check for existing wallet in localStorage
            const savedWallet = localStorage.getItem('zhtp_wallet');
            if (savedWallet) {
                const walletData = JSON.parse(savedWallet);
                if (walletData && walletData.address) {
                    // Auto-sign in returning users
                    currentUser = walletData;
                    currentWallet = walletData;
                    showUserInfo();
                    updateWalletDisplay();
                    
                    // Show appropriate welcome message
                    let welcomeMsg = `Welcome back ${currentUser.address.substring(0, 15)}...!`;
                    if (currentUser.zk_identity) {
                        welcomeMsg = `üîê ZK Identity verified! ${currentUser.address.substring(0, 15)}...`;
                    }
                    showToast(welcomeMsg, 'success');
                    
                    // Clean up URL if there are any parameters from onboarding
                    const urlParams = new URLSearchParams(window.location.search);
                    if (urlParams.has('wallet') && window.history && window.history.replaceState) {
                        const newUrl = window.location.protocol + "//" + window.location.host + window.location.pathname;
                        window.history.replaceState({}, document.title, newUrl);
                    }
                    return;
                }
            }

            // Check session storage
            const savedUser = localStorage.getItem('zhtpUser');
            const savedWalletSession = localStorage.getItem('zhtpWallet');
            
            if (savedUser && savedWalletSession) {
                currentUser = JSON.parse(savedUser);
                currentWallet = JSON.parse(savedWalletSession);
                showUserInfo();
                updateWalletDisplay();
                return;
            }

            // No authentication found, redirect to onboarding
            showToast('Please complete onboarding first', 'warning');
            setTimeout(() => {
                window.location.href = '/welcome-merged.html';
            }, 2000);
        }

        // Show user info
        function showUserInfo() {
            if (currentUser) {
                const username = currentUser.username || currentUser.signInMethod || 'U';
                document.getElementById('userAvatar').textContent = username.charAt(0).toUpperCase();
                
                // Update wallet info display
                if (currentUser.address) {
                    document.getElementById('walletAddress').textContent = 
                        currentUser.address.substring(0, 20) + '...';
                    document.getElementById('walletBalance').textContent = 
                        (currentUser.balance || 0) + ' ZHTP';
                }
            }
        }

        // Toggle user menu
        function toggleUserMenu() {
            const dropdown = document.getElementById('userDropdown');
            dropdown.classList.toggle('active');
        }

        // Update wallet display
        function updateWalletDisplay() {
            if (currentWallet) {
                document.getElementById('walletAddress').textContent = currentWallet.address || 'Not connected';
                document.getElementById('walletBalance').textContent = (currentWallet.balance || 0) + ' ZHTP';
                document.getElementById('walletNetwork').textContent = 'Testnet';
            }
        }

        // Tab switching
        function switchTab(tabName) {
            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // Add active class to selected tab
            document.getElementById(tabName + 'Tab').classList.add('active');
            document.getElementById(tabName + 'Content').classList.add('active');
            
            // Load tab-specific content
            loadTabContent(tabName);
        }

        // Load tab content
        function loadTabContent(tabName) {
            switch(tabName) {
                case 'network':
                    updateNetworkStatus();
                    loadDapps();
                    break;
                case 'explorer':
                    searchDApps();
                    break;
                case 'wallet':
                    updateWalletDisplay();
                    break;
                case 'dns':
                    loadDNSRegistry();
                    break;
                case 'dao':
                    loadDAOData();
                    break;
                case 'tools':
                    loadDevTools();
                    break;
            }
        }

        // Network navigation
        function navigate() {
            const url = document.getElementById('urlBar').value.trim();
            if (!url) return;
            
            // Update address bar
            document.getElementById('urlBar').value = url;
            
            if (url.endsWith('.zhtp') || url.startsWith('zhtp://')) {
                // Handle ZHTP domain
                const domain = url.replace('zhtp://', '');
                loadDomain(domain);
            } else if (url.startsWith('http://') || url.startsWith('https://')) {
                // Handle traditional URL
                showToast('Opening external URL: ' + url, 'info');
                window.open(url, '_blank');
            } else {
                // Treat as search
                searchNetwork('general', url);
            }
        }

        // Load ZHTP domain with real DNS resolution
        async function loadDomain(domain) {
            console.log(`üîç ZHTP DNS: Resolving ${domain}...`);
            
            // Show loading in current tab
            showToast(`Resolving ${domain} via ZHTP DNS...`, 'info');
            
            // Special handling for known domains
            if (domain === 'whisper.zhtp' || domain === 'whisper.chat' || domain === 'whisper') {
                console.log('üîí Redirecting to Whisper secure messaging...');
                window.open('./whisper.html', '_blank');
                return;
            }
            
            try {
                const response = await fetch(`/api/dns/resolve?domain=${encodeURIComponent(domain)}`);
                const data = await response.json();
                
                if (data.success) {
                    showToast(`‚úÖ ${domain} resolved successfully`, 'success');
                    console.log('Domain resolved:', data);
                    
                    // For demo purposes, show resolution info
                    const resultHTML = `
                        <div class="explorer-card" style="margin-top: 20px; border: 2px solid #00ff00;">
                            <h3>‚úÖ Domain Resolution: ${domain}</h3>
                            <p><strong>Addresses:</strong> ${data.addresses?.join(', ')}</p>
                            <p><strong>TTL:</strong> ${data.ttl} seconds</p>
                            <p><strong>ZK Verified:</strong> ${data.zk_verified ? '‚úÖ Yes' : '‚ùå No'}</p>
                            <p><strong>Status:</strong> Active</p>
                            <button class="action-btn" onclick="window.open('http://${data.addresses?.[0]}', '_blank')">
                                üåê Open in New Tab
                            </button>
                        </div>
                    `;
                    
                    document.getElementById('searchResults').innerHTML = resultHTML;
                    switchTab('explorer');
                } else {
                    showToast(`‚ùå Domain not found: ${domain}`, 'error');
                    
                    const errorHTML = `
                        <div class="explorer-card" style="margin-top: 20px; border: 2px solid #ff0000;">
                            <h3>‚ùå Domain Not Found: ${domain}</h3>
                            <p>This domain is not registered on the ZHTP network.</p>
                            <p>Would you like to register it?</p>
                            <button class="action-btn success" onclick="document.getElementById('domainInput').value='${domain}'; switchTab('explorer'); document.getElementById('domainInput').focus();">
                                Register ${domain}
                            </button>
                        </div>
                    `;
                    
                    document.getElementById('searchResults').innerHTML = errorHTML;
                    switchTab('explorer');
                }
            } catch (error) {
                console.error('DNS resolution failed:', error);
                showToast(`DNS resolution failed: ${error.message}`, 'error');
            }
        }

        function goBack() {
            window.history.back();
        }

        function goForward() {
            window.history.forward();
        }

        function goHome() {
            document.getElementById('urlBar').value = '';
            document.getElementById('searchResults').innerHTML = '';
            switchTab('network');
        }

        // Network search function
        function searchNetwork(type = 'general', query = null) {
            const searchQuery = query || document.getElementById('searchInput').value.trim();
            if (!searchQuery) return;
            
            console.log(`üîç Searching ${type}: ${searchQuery}`);
            
            let results = '';
            
            switch(type) {
                case 'dns':
                    loadDomain(searchQuery);
                    return;
                    
                case 'dapp':
                    results = searchDApps(searchQuery);
                    break;
                    
                case 'contract':
                    results = searchContracts(searchQuery);
                    break;
                    
                case 'transaction':
                    results = searchTransactions(searchQuery);
                    break;
                    
                default:
                    results = searchGeneral(searchQuery);
            }
            
            document.getElementById('searchResults').innerHTML = results;
            switchTab('explorer');
        }

        function searchDApps(query) {
            const mockDApps = [
                { name: 'ZHTP News Hub', domain: 'news.zhtp', description: 'Decentralized news platform' },
                { name: 'ZHTP Marketplace', domain: 'market.zhtp', description: 'Decentralized trading platform' },
                { name: 'Whisper Chat', domain: 'whisper.zhtp', description: 'Quantum-resistant messaging' }
            ];
            
            const filtered = mockDApps.filter(dapp => 
                dapp.name.toLowerCase().includes(query.toLowerCase()) ||
                dapp.domain.toLowerCase().includes(query.toLowerCase())
            );
            
            if (filtered.length === 0) {
                return `<div class="explorer-card"><h3>No DApps found for "${query}"</h3></div>`;
            }
            
            return `<h3>üöÄ DApp Search Results for "${query}"</h3>` + 
                   filtered.map(dapp => `
                       <div class="dapp-card" onclick="loadDomain('${dapp.domain}')">
                           <h3>${dapp.name}</h3>
                           <div class="domain">${dapp.domain}</div>
                           <p>${dapp.description}</p>
                           <div class="dapp-status">Active</div>
                       </div>
                   `).join('');
        }

        function searchContracts(query) {
            return `
                <div class="explorer-card">
                    <h3>üìú Smart Contract Search: "${query}"</h3>
                    <p>Contract search functionality coming soon!</p>
                    <p>This will search for deployed smart contracts on the ZHTP network.</p>
                </div>
            `;
        }

        function searchTransactions(query) {
            return `
                <div class="explorer-card">
                    <h3>üí∞ Transaction Search: "${query}"</h3>
                    <p>Transaction search functionality coming soon!</p>
                    <p>This will search for transactions by hash, address, or amount.</p>
                </div>
            `;
        }

        function searchGeneral(query) {
            // If it looks like a domain, try DNS resolution
            if (query.includes('.zhtp') || query.includes('.')) {
                loadDomain(query);
                return '';
            }
            
            // Otherwise show general search results
            return `
                <div class="explorer-card">
                    <h3>üîç Search Results for "${query}"</h3>
                    <p>General network search functionality coming soon!</p>
                    <div style="margin-top: 15px;">
                        <button class="action-btn" onclick="searchNetwork('dns', '${query}.zhtp')">
                            Try as DNS: ${query}.zhtp
                        </button>
                        <button class="action-btn" onclick="searchNetwork('dapp', '${query}')">
                            Search DApps
                        </button>
                    </div>
                </div>
            `;
        }

        // Network functions
        async function updateNetworkStatus() {
            try {
                const response = await fetch('/api/status');
                const data = await response.json();
                networkData = data;
                
                document.getElementById('networkStatusText').textContent = data.status || 'Unknown';
                document.getElementById('connectedNodes').textContent = data.connected_nodes || 0;
                document.getElementById('consensusRounds').textContent = data.consensus_rounds || 0;
                document.getElementById('zkProofs').textContent = data.zk_transactions || 0;
                document.getElementById('dappCount').textContent = data.dapp_count || 0;
                document.getElementById('peerCount').textContent = data.connected_nodes || 0;
                
                // Update status indicators
                const indicators = document.querySelectorAll('.status-indicator');
                indicators.forEach(indicator => {
                    indicator.style.background = data.status === 'operational' ? '#00ff00' : '#ff0000';
                });
                
                // Add log entry for network status
                if (data.status === 'operational') {
                    addLog(`‚úÖ Network operational: ${data.connected_nodes} nodes connected`, 'success');
                } else {
                    addLog(`‚ö†Ô∏è Network status: ${data.status}`, 'warning');
                }
                
            } catch (error) {
                console.error('Failed to fetch network status:', error);
                showToast('Failed to connect to network', 'error');
                addLog('‚ùå Failed to fetch network status', 'error');
            }
        }

        async function loadDapps() {
            try {
                const response = await fetch('/api/dapps');
                const data = await response.json();
                dappsData = data.dapps || [];
                
                const grid = document.getElementById('dappGrid');
                grid.innerHTML = '';
                
                if (dappsData.length === 0) {
                    // Show fallback DApps for demo
                    const fallbackDApps = [
                        {
                            name: 'ZHTP News Hub',
                            domain: 'news.zhtp',
                            description: 'Decentralized news platform with ZK-verified journalism',
                            status: 'Live',
                            zk_features: ['Anonymous voting', 'Verified sources']
                        },
                        {
                            name: 'Whisper Chat',
                            domain: 'whisper.zhtp',
                            description: 'Quantum-resistant secure messaging platform',
                            status: 'Active',
                            zk_features: ['End-to-end encryption', 'Quantum resistance']
                        },
                        {
                            name: 'ZHTP Marketplace',
                            domain: 'market.zhtp',
                            description: 'Decentralized trading platform with instant settlements',
                            status: 'Beta',
                            zk_features: ['Private transactions', 'Zero-knowledge proofs']
                        }
                    ];
                    dappsData = fallbackDApps;
                }
                
                dappsData.forEach(dapp => {
                    const card = document.createElement('div');
                    card.className = 'dapp-card';
                    card.innerHTML = `
                        <h3>${dapp.name}</h3>
                        <div class="domain">${dapp.domain}</div>
                        <p>${dapp.description}</p>
                        <div class="dapp-status">${dapp.status}</div>
                        ${dapp.zk_features ? `
                            <div style="margin-top: 10px; font-size: 12px; color: #888;">
                                ZK Features: ${dapp.zk_features.join(', ')}
                            </div>
                        ` : ''}
                    `;
                    card.onclick = () => navigateToDapp(dapp.domain);
                    grid.appendChild(card);
                });
                
            } catch (error) {
                console.error('Failed to load DApps:', error);
                document.getElementById('dappGrid').innerHTML = '<p>Failed to load DApps. Please check your connection.</p>';
            }
        }

        function navigateToDapp(domain) {
            document.getElementById('urlBar').value = domain;
            navigate();
        }

        // Wallet functions
        async function createQuantumWallet() {
            if (currentWallet) {
                showToast('Wallet already exists! Use reset to create a new one.', 'warning');
                return;
            }
            
            try {
                const response = await fetch('/api/wallet/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        username: currentUser?.username || 'anonymous',
                        network: 'testnet',
                        quantum_resistant: true
                    })
                });
                
                const wallet = await response.json();
                if (wallet.success) {
                    currentWallet = {
                        address: wallet.wallet_address,
                        publicKey: wallet.public_key,
                        balance: 0,
                        network: wallet.network,
                        quantum_resistant: true,
                        algorithm: 'Dilithium5+Kyber768'
                    };
                    
                    localStorage.setItem('zhtpWallet', JSON.stringify(currentWallet));
                    updateWalletDisplay();
                    showToast('‚úÖ Quantum-resistant wallet created!', 'success');
                } else {
                    throw new Error(wallet.error || 'Failed to create wallet');
                }
                
            } catch (error) {
                console.error('Failed to create wallet:', error);
                
                // Create a mock wallet for demo purposes
                currentWallet = {
                    address: 'zhtp1' + Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15),
                    publicKey: 'pk_' + Math.random().toString(36).substring(2, 20),
                    balance: 0,
                    network: 'testnet',
                    quantum_resistant: true,
                    algorithm: 'Dilithium5+Kyber768'
                };
                
                localStorage.setItem('zhtpWallet', JSON.stringify(currentWallet));
                updateWalletDisplay();
                showToast('‚úÖ Demo quantum wallet created!', 'success');
            }
        }

        async function requestTestTokens() {
            if (!currentWallet) {
                showToast('Please create a wallet first', 'warning');
                return;
            }
            
            // Request test tokens via API
            fetch('/api/wallet/faucet', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ wallet_address: currentWallet.address })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    currentWallet.balance = data.new_balance;
                    localStorage.setItem('zhtpWallet', JSON.stringify(currentWallet));
                    updateWalletDisplay();
                    showToast(`${data.amount} test ZHTP tokens added to your wallet!`, 'success');
                    addLog(`üíß Faucet: ${data.amount} ZHTP tokens distributed`, 'success');
                } else {
                    showToast('Faucet request failed: ' + (data.error || 'Unknown error'), 'error');
                }
            })
            .catch(error => {
                showToast('Faucet request failed: ' + error.message, 'error');
            });
        }

        function resetWallet() {
            if (confirm('Are you sure you want to reset your wallet? This action cannot be undone.')) {
                localStorage.removeItem('zhtpWallet');
                currentWallet = null;
                updateWalletDisplay();
                showToast('Wallet reset successfully', 'info');
            }
        }

        // Domain functions
        function registerDomain() {
            const domain = document.getElementById('domainInput').value.trim();
            if (!domain) {
                showToast('Please enter a domain name', 'warning');
                return;
            }
            
            if (!currentWallet) {
                showToast('Please create a wallet first', 'warning');
                return;
            }
            
            // Register domain via API
            showToast(`üìù Registering domain: ${domain}...`, 'info');
            
            fetch('/api/dns/register', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    domain: domain,
                    wallet_address: currentWallet.address,
                    record_type: 'A'
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showToast(`‚úÖ Domain ${domain} registered successfully!`, 'success');
                    addLog(`üåç DNS: ${domain} registered`, 'success');
                    
                    const userDomainsDiv = document.getElementById('userDomains');
                    const currentDomains = userDomainsDiv.innerHTML;
                    
                    if (currentDomains.includes('No domains registered')) {
                        userDomainsDiv.innerHTML = '';
                    }
                    
                    userDomainsDiv.innerHTML += `
                        <div style="margin: 10px 0; padding: 10px; background: rgba(0,255,0,0.1); border-radius: 5px; border: 1px solid rgba(0,255,0,0.3);">
                            <strong>‚úÖ ${domain}</strong>
                            <p style="font-size: 12px; opacity: 0.8;">Registered: ${new Date().toLocaleDateString()}</p>
                            <button class="action-btn" onclick="loadDomain('${domain}')" style="margin-top: 5px; padding: 5px 10px; font-size: 12px;">
                                üåê Visit Domain
                            </button>
                        </div>
                    `;
                } else {
                    showToast('Domain registration failed: ' + (data.error || 'Unknown error'), 'error');
                }
            })
            .catch(error => {
                showToast('Domain registration failed: ' + error.message, 'error');
            });
        }

        function copyDomain(domain) {
            navigator.clipboard.writeText(domain).then(() => {
                showToast(`üìã Copied ${domain} to clipboard`, 'success');
            });
        }

        function resolveDomain(domain) {
            if (!domain) {
                domain = document.getElementById('dnsLookup')?.value;
            }
            
            if (domain) {
                fetch(`/api/dns/resolve?domain=${encodeURIComponent(domain)}`)
                    .then(response => response.json())
                    .then(data => {
                        const results = document.getElementById('dnsResults');
                        if (data.success) {
                            results.innerHTML = `
                                <h4>‚úÖ Domain Resolved</h4>
                                <p><strong>Domain:</strong> ${data.domain}</p>
                                <p><strong>Address:</strong> ${data.addresses?.join(', ')}</p>
                                <p><strong>TTL:</strong> ${data.ttl} seconds</p>
                                <p><strong>ZK Verified:</strong> ${data.zk_verified ? '‚úÖ' : '‚ùå'}</p>
                            `;
                        } else {
                            results.innerHTML = `<p>‚ùå Domain not found: ${domain}</p>`;
                        }
                    })
                    .catch(error => {
                        console.error('DNS resolution failed:', error);
                        showToast('DNS resolution failed', 'error');
                    });
            }
        }

        // DAO functions
        function submitProposal() {
            const title = document.getElementById('proposalTitle').value;
            const description = document.getElementById('proposalDescription').value;
            const type = document.getElementById('proposalType').value;
            
            if (title && description) {
                // Submit DAO proposal via API
                fetch('/api/dao/propose', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        title: title,
                        description: description,
                        type: type,
                        proposer: currentWallet?.address
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showToast('DAO proposal submitted successfully!', 'success');
                        addLog(`üèõÔ∏è DAO: New proposal "${title}" submitted`, 'info');
                        
                        document.getElementById('proposalStatus').innerHTML = `
                            <h4>‚úÖ Proposal Submitted</h4>
                            <p><strong>Title:</strong> ${title}</p>
                            <p><strong>Type:</strong> ${type}</p>
                            <p><strong>ID:</strong> ${data.proposal_id}</p>
                            <p><strong>Status:</strong> Under Review</p>
                        `;
                        
                        // Clear form
                        document.getElementById('proposalTitle').value = '';
                        document.getElementById('proposalDescription').value = '';
                    } else {
                        showToast('Proposal submission failed: ' + (data.error || 'Unknown error'), 'error');
                    }
                })
                .catch(error => {
                    showToast('Proposal submission failed: ' + error.message, 'error');
                });
            }
        }

        // Network switching
        function switchNetwork(network) {
            showToast(`Switched to ${network} network`, 'info');
            updateNetworkStatus();
        }

        // User menu functions
        function showWalletDetails() {
            if (!currentUser && !currentWallet) {
                showToast('No wallet connected', 'warning');
                return;
            }
            
            const wallet = currentWallet || currentUser;
            const zkIdentityInfo = wallet.zk_identity ? 
                `ZK Identity: ${wallet.zk_identity}\n` : 
                'ZK Identity: Not available (Legacy wallet)\n';
                
            const signInMethod = wallet.signInMethod ? 
                `Sign-in Method: ${wallet.signInMethod.replace('_', ' ').toUpperCase()}\n` : 
                'Sign-in Method: Quantum Wallet\n';
                
            const details = `üè¶ Wallet Details
==================
${zkIdentityInfo}Address: ${wallet.address || 'Not connected'}
Balance: ${wallet.balance || 0} ZHTP
Network: ${wallet.network || 'Testnet'}
Quantum-Resistant: ${wallet.quantum_resistant ? '‚úÖ Yes' : '‚ùå No'}
Algorithm: ${wallet.algorithm || 'Standard'}
${signInMethod}

üîê Security: ${wallet.quantum_resistant ? 'Quantum-resistant encryption active' : 'Standard encryption'}
üí° Tip: Your quantum wallet provides future-proof security`;
            
            alert(details);
            toggleUserMenu();
        }

        function showEarnings() {
            if (!currentUser && !currentWallet) {
                showToast('No wallet connected', 'warning');
                return;
            }
            
            const wallet = currentWallet || currentUser;
            const zkInfo = wallet.zk_identity ? 
                `ZK Identity: ${wallet.zk_identity}\n` : 
                'ZK Identity: Quantum wallet\n';
                
            const earnings = `üìä Earnings Dashboard
===================
${zkInfo}Current Balance: ${wallet.balance || 0} ZHTP
Network: ${wallet.network || 'Testnet'}
Node Type: ${wallet.nodeType || 'Light Node'}
Daily Estimate: ${wallet.earnings || '0.1 ZHTP'}

üîê Security: Quantum-resistant wallet active
üí° Tip: Keep your node online for maximum earnings!`;
            
            alert(earnings);
            toggleUserMenu();
        }

        function showSettings() {
            alert('‚öôÔ∏è Settings panel coming soon! You can change network settings, node type, and privacy preferences.');
            toggleUserMenu();
        }

        function signOut() {
            if (confirm('Are you sure you want to sign out? Your wallet data will be preserved for future sign-ins.')) {
                // Clear session data but keep wallet for future use
                sessionStorage.removeItem('zhtp_session');
                currentUser = null;
                showToast('‚úÖ Signed out successfully!', 'success');
                setTimeout(() => {
                    window.location.href = '/welcome-merged.html';
                }, 1500);
            }
            toggleUserMenu();
        }

        // Toast notifications
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Placeholder functions for missing features
        function deployDApp() {
            const name = document.getElementById('dappName').value.trim();
            const description = document.getElementById('dappDescription').value.trim();
            const codeFile = document.getElementById('dappCode').files[0];
            
            if (!name || !description) {
                showToast('Please enter DApp name and description', 'warning');
                return;
            }
            
            if (!currentWallet) {
                showToast('Please create a wallet first', 'warning');
                return;
            }
            
            const deployStatus = document.getElementById('deployStatus');
            deployStatus.innerHTML = '<div class="loading"></div> Deploying DApp...';
            
            // Deploy DApp via API
            const formData = new FormData();
            formData.append('name', name);
            formData.append('description', description);
            formData.append('wallet_address', currentWallet?.address);
            if (codeFile) {
                formData.append('code', codeFile);
            }
            
            fetch('/api/dapp/deploy', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    deployStatus.innerHTML = `
                        <div style="background: rgba(0,255,0,0.1); padding: 15px; border-radius: 10px; border: 1px solid rgba(0,255,0,0.3); margin-top: 15px;">
                            <h4>‚úÖ DApp Deployed Successfully!</h4>
                            <p><strong>Name:</strong> ${name}</p>
                            <p><strong>Domain:</strong> ${data.domain}</p>
                            <p><strong>Status:</strong> Active</p>
                            <p><strong>Contract ID:</strong> ${data.contract_id}</p>
                            <button class="action-btn" onclick="loadDomain('${data.domain}')" style="margin-top: 10px;">
                                üåê Visit DApp
                            </button>
                        </div>
                    `;
                    
                    showToast(`üöÄ DApp "${name}" deployed to ${data.domain}!`, 'success');
                    addLog(`üöÄ DApp deployed: ${name} at ${data.domain}`, 'success');
                    
                    // Clear form
                    document.getElementById('dappName').value = '';
                    document.getElementById('dappDescription').value = '';
                    document.getElementById('dappCode').value = '';
                } else {
                    deployStatus.innerHTML = `<p style="color: #ff4444;">‚ùå Deployment failed: ${data.error || 'Unknown error'}</p>`;
                    showToast('DApp deployment failed: ' + (data.error || 'Unknown error'), 'error');
                }
            })
            .catch(error => {
                deployStatus.innerHTML = `<p style="color: #ff4444;">‚ùå Deployment failed: ${error.message}</p>`;
                showToast('DApp deployment failed: ' + error.message, 'error');
            });
        }

        function sendTransaction() {
            showToast('Transaction feature coming soon!', 'info');
        }

        function refreshTransactions() {
            showToast('Transaction history refreshed', 'info');
        }

        function loadDNSRegistry() {
            document.getElementById('dnsRegistry').innerHTML = `
                <div class="dapp-card">
                    <h4>news.zhtp</h4>
                    <p>Decentralized news platform</p>
                    <div class="dapp-status">Active</div>
                </div>
                <div class="dapp-card">
                    <h4>market.zhtp</h4>
                    <p>Zero-knowledge trading platform</p>
                    <div class="dapp-status">Active</div>
                </div>
                <div class="dapp-card">
                    <h4>whisper.zhtp</h4>
                    <p>Quantum-resistant secure messaging</p>
                    <div class="dapp-status">Active</div>
                </div>
            `;
        }

        function refreshDNS() {
            loadDNSRegistry();
            showToast('DNS registry refreshed', 'info');
        }

        function loadDAOData() {
            document.getElementById('activeProposals').innerHTML = `
                <div class="dapp-card">
                    <h4>Network Upgrade Proposal</h4>
                    <p>Upgrade consensus algorithm for better performance</p>
                    <div class="dapp-status">Voting</div>
                </div>
            `;
        }

        function refreshProposals() {
            loadDAOData();
            showToast('Proposals refreshed', 'info');
        }

        function stakeTokens() {
            showToast('Token staking feature coming soon!', 'info');
        }

        function loadDevTools() {
            document.getElementById('analyticsData').innerHTML = `
                <div class="stat-card">
                    <div class="value">99.9%</div>
                    <div class="label">Network Uptime</div>
                </div>
                <div class="stat-card">
                    <div class="value">156ms</div>
                    <div class="label">Avg Block Time</div>
                </div>
            `;
        }

        function deployContract() {
            showToast('Smart contract deployment coming soon!', 'info');
        }

        function testNetwork() {
            showToast('Network test: All systems operational ‚úÖ', 'success');
        }

        function testConsensus() {
            showToast('Consensus test: ZK-PoS working correctly ‚úÖ', 'success');
        }

        function testZKProofs() {
            showToast('ZK Proof test: Verification successful ‚úÖ', 'success');
        }

        function generateReport() {
            showToast('Analytics report generated!', 'info');
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const userMenu = document.querySelector('.user-menu');
            const dropdown = document.getElementById('userDropdown');
            
            if (!userMenu.contains(event.target)) {
                dropdown.classList.remove('active');
            }
        });

        // Initialize everything
        document.addEventListener('DOMContentLoaded', function() {
            initQuantumParticles();
            checkAuthentication();
            updateNetworkStatus();
            loadDapps();
            loadSavedDomains();
            startNetworkMonitoring(); // Start the live network activity feed
            
            // Update network status every 5 seconds
            setInterval(updateNetworkStatus, 5000);
            
            // Add Enter key listener to URL bar
            document.getElementById('urlBar').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    navigate();
                }
            });
            
            // Add Enter key listener to search input
            document.getElementById('searchInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchNetwork();
                }
            });
        });

        // Load saved domains from localStorage
        function loadSavedDomains() {
            const savedDomains = JSON.parse(localStorage.getItem('zhtpDomains') || '[]');
            const userDomainsDiv = document.getElementById('userDomains');
            
            if (savedDomains.length === 0) {
                userDomainsDiv.innerHTML = 'No domains registered';
                return;
            }
            
            userDomainsDiv.innerHTML = '';
            savedDomains.forEach(domainInfo => {
                userDomainsDiv.innerHTML += `
                    <div style="margin: 10px 0; padding: 10px; background: rgba(0,255,0,0.1); border-radius: 5px; border: 1px solid rgba(0,255,0,0.3);">
                        <strong>‚úÖ ${domainInfo.domain}</strong>
                        <p style="font-size: 12px; opacity: 0.8;">Registered: ${new Date(domainInfo.registeredAt).toLocaleDateString()}</p>
                        <button class="action-btn" onclick="loadDomain('${domainInfo.domain}')" style="margin-top: 5px; padding: 5px 10px; font-size: 12px;">
                            üåê Visit Domain
                        </button>
                    </div>
                `;
            });
        }
    </script>
</body>
</html>
